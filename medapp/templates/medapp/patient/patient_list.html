{% extends "medapp/base.html" %}
{% block title %}Patient Management System{% endblock %}

{% block content %}
<div class="patients-container">
    <div class="page-header">
        <div class="header-content">
            <h1>Patient Registry</h1>
            <p class="page-subtitle">Total Patients: {{ patients.count }}</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'medapp:patient_create' %}" class="btn btn-primary">
                + Add New Patient
            </a>
        </div>
    </div>

    <div class="patients-grid">
        {% for p in patients %}
        <div class="patient-card">
            <div class="patient-card-header">
                <h2 class="patient-name">
                    <a href="{% url 'medapp:patient_detail' p.id %}" class="patient-link">
                        {{ p.name }}
                    </a>
                </h2>
                <span class="patient-badge age-badge">{{ p.age }} years</span>
            </div>
            
            <div class="patient-card-body">
                <div class="patient-meta">
                    <div class="meta-item">
                        <span class="meta-label">Gender</span>
                        <span class="meta-value">{{ p.gender|default:"Not specified" }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Assigned To</span>
                        <span class="meta-value">
                            {% with practitioners=p.assigned_to.all %}
                                {% if practitioners %}
                                    {% for tm in practitioners %}
                                        {{ tm.name }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                {% else %}
                                    Not assigned
                                {% endif %}
                            {% endwith %}
                        </span>
                    </div>
                </div>
                
                <div class="medical-summary">
                    <label class="summary-label">Medical Summary</label>
                    <div class="summary-content">
                        {% if p.medical_history %}
                            {{ p.medical_history|truncatewords:30|linebreaks }}
                        {% else %}
                            <span class="no-summary">No medical history recorded</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="patient-card-footer">
                <a href="{% url 'medapp:patient_detail' p.id %}" class="btn-view-details">
                    View Full Record ‚Üí
                </a>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <div class="empty-icon">üë•</div>
            <h3>No Patients Found</h3>
            <p>There are currently no patients in the system.</p>
            <a href="{% url 'medapp:patient_create' %}" class="btn btn-primary">
                Add Your First Patient
            </a>
        </div>
        {% endfor %}
    </div>

    <!-- Optional: Pagination -->
    <!-- {% if is_paginated %}
    <div class="pagination">
        <span class="page-links">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}">‚Üê Previous</a>
            {% endif %}
            <span class="page-current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">Next ‚Üí</a>
            {% endif %}
        </span>
    </div>
    {% endif %} -->
</div>
{% endblock %}